<!DOCTYPE html>
<html>
<head>
  <title>Mind Map Viewer</title>
  <script src="https://unpkg.com/@xyflow/react/dist/umd/index.js"></script>
  <link href="https://unpkg.com/@xyflow/react/dist/style.css" rel="stylesheet" />
  <style>
    body { margin: 0; padding: 20px; font-family: system-ui, sans-serif; }
    .mindmap-container { width: 100vw; height: 100vh; }
    .upload-container {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 10;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .dialog {
      padding: 20px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      max-width: 500px;
      margin: 20px auto;
    }
    .dialog h3 { margin-bottom: 16px; }
    .content-item, .link-item {
      padding: 8px;
      background: #f1f1f1;
      margin: 4px 0;
      border-radius: 4px;
    }
    .link-item {
      display: block;
      text-decoration: none;
      color: #333;
    }
    .close-button {
      margin-top: 16px;
      padding: 8px 16px;
      background: #6366F1;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="upload-container">
    <input type="file" id="fileInput" accept=".json" />
    <p>Upload your exported mind map JSON file</p>
  </div>
  <div id="mindmap" class="mindmap-container"></div>

  <script>
    const fileInput = document.getElementById('fileInput');
    
    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          const { nodes, edges } = JSON.parse(e.target.result);
          initializeMindMap(nodes, edges);
        };
        reader.readAsText(file);
      }
    });

    function initializeMindMap(nodes, edges) {
      const nodeTypes = {
        base: {
          render: (nodeProps) => {
            const { data } = nodeProps;
            const style = {
              background: data.backgroundColor || 'white',
              border: `${data.strokeWidth}px ${data.strokeStyle} ${data.strokeColor}`,
              borderRadius: '8px',
              padding: '10px',
              minWidth: '100px',
              minHeight: '40px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              cursor: 'pointer',
              fontSize: data.fontSize === 'xs' ? '10px' : 
                       data.fontSize === 's' ? '12px' :
                       data.fontSize === 'm' ? '14px' :
                       data.fontSize === 'l' ? '16px' : '20px',
              textAlign: data.textAlign || 'center',
              opacity: data.opacity || 1,
            };

            return ReactFlow.createElement(
              'div',
              { 
                style,
                onClick: () => {
                  if (data.content?.length || data.links?.length) {
                    const dialog = document.createElement('dialog');
                    dialog.className = 'dialog';
                    dialog.innerHTML = `
                      <h3>${data.label}</h3>
                      ${data.content?.length ? `
                        <div style="margin-bottom: 16px;">
                          <h4>Content</h4>
                          ${data.content.map(item => `
                            <div class="content-item">${item.text}</div>
                          `).join('')}
                        </div>
                      ` : ''}
                      ${data.links?.length ? `
                        <div>
                          <h4>Links</h4>
                          ${data.links.map(link => `
                            <a href="${link.url}" target="_blank" class="link-item">
                              ${link.label}
                            </a>
                          `).join('')}
                        </div>
                      ` : ''}
                      <button class="close-button" onclick="this.closest('dialog').close()">
                        Close
                      </button>
                    `;
                    document.body.appendChild(dialog);
                    dialog.showModal();
                    dialog.addEventListener('click', (e) => {
                      if (e.target === dialog) dialog.close();
                    });
                  }
                }
              },
              data.label,
              data.content?.length || data.links?.length ? 
                ReactFlow.createElement('div', { 
                  style: { 
                    fontSize: '10px',
                    color: '#666',
                    marginTop: '4px'
                  } 
                }, 'Click to view details') : null
            );
          }
        }
      };

      new ReactFlow.ReactFlow({
        nodes,
        edges,
        nodeTypes,
        fitView: true,
        nodesDraggable: false,
        nodesConnectable: false,
        elementsSelectable: false,
      });
    }
  </script>
</body>
</html>